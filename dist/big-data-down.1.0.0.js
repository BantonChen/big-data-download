!function(e){const t={totalPage:1,currentPage:1,downAoa:[],url:"",downExcel:function(t){let o=document.getElementById("loading");o||(o=document.createElement("div")),o.id="loading",o.innerHTML='<DIV STYLE="BORDER: buttonhighlight 1px outset; FONT-SIZE: 14px; Z-INDEX:4; FONT-FAMILY: Tahoma; POSITION: absolute; BACKGROUND-COLOR: #fff;WIDTH: 350px;left:50%;top:10%;margin-left:-175px; CURSOR: default" ID="divProgressDialog" onselectstart="window.event.returnValue=false;">   <DIV STYLE="PADDING: 8px; FONT-WEIGHT: bolder; COLOR:#FFF;BORDER-BOTTOM: white 2px groove; BACKGROUND-COLOR: #409EFF">      导出数据   </DIV>   <DIV STYLE="PADDING: 5px">      正在生成数据，请等待.....   </DIV>   <DIV STYLE="PADDING: 5px">      这个过程可能需要几分钟   </DIV>   <DIV STYLE="PADDING: 5px">         <DIV ID="divProgressOuter" STYLE="BORDER: 1px solid threedshadow;WIDTH: 336px; HEIGHT: 25px">            <DIV ID="divProgressInner" STYLE="COLOR: white; TEXT-ALIGN:center; BACKGROUND-COLOR: GREEN; MARGIN: 0px; WIDTH: 0px; HEIGHT:25px;"></DIV>         </DIV>   </DIV>   <DIV STYLE="BORDER-TOP: white 2px groove; PADDING-BOTTOM: 5px; PADDING-TOP: 3px;BACKGROUND-COLOR: buttonface; TEXT-ALIGN: center;margin-top: 7px;">         <INPUT STYLE="FONT-FAMILY: Tahoma; FONT-SIZE: 14px;" TYPE="button" ID="btnCancel" onclick="stopLongProcess();" VALUE="取 消">   </DIV></DIV>\x3c!-- 结束下载 --\x3e\x3c!-- BEGIN FAKE MODAL DIV--\x3e<DIV ID="divModal"   STYLE="BACKGROUND-COLOR: white; FILTER: alpha(opacity=75); LEFT: 0px; POSITION: absolute; TOP: 0px; Z-INDEX: 3"   onclick="window.event.cancelBubble=true; window.event.returnValue=false;"></DIV>';let n=this;n.url=t.indexOf("?")>-1?t+"&page=":t+"?page=",e.document.body.appendChild(o),n.AjaxJson(n.url+n.currentPage).then((function(e){if(document.getElementById("divProgressInner").style.width=1/e.total_page*336+"px",e.hasOwnProperty("header")&&n.downAoa.push(e.header),e.hasOwnProperty("total_page")||(e.total_page=1),e.hasOwnProperty("data")){for(let t in e.data){let o=[];for(let n in e.data[t])o.push(e.data[t][n]);n.downAoa.push(o)}n.totalPage=e.total_page,n.totalPage>1?(n.currentPage+=1,n.doWork()):n.dataToExcel()}else e.data=e}))},dataToExcel:function(){this.openDownloadDialog(this.sheet2blob(XLSX.utils.aoa_to_sheet(this.downAoa)),"001.xlsx");let e=document.getElementById("loading");e.parentNode.removeChild(e)},doWork:function(){var e=this;e.AjaxJson(e.url+e.currentPage).then((function(t){if(e.currentPage+=1,console.log(e.currentPage),e.currentPage>e.totalPage)e.dataToExcel();else{document.getElementById("divProgressInner").style.width=e.currentPage/e.totalPage*336+"px";for(let o in t.data){let n=[];for(let e in t.data[o])n.push(t.data[o][e]);e.downAoa.push(n)}e.doWork()}}))},AjaxJson:function(t){return new Promise(((o,n)=>{if(e.XMLHttpRequest)var a=new XMLHttpRequest;else a=new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",t,!0),a.send(),a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){let e=new Function("return "+a.responseText)();o(e)}else n()}}))},openDownloadDialog:function(t,o){"object"==typeof t&&t instanceof Blob&&(t=URL.createObjectURL(t));let n,a=document.createElement("a");a.href=t,a.download=o||"",e.MouseEvent?n=new MouseEvent("click"):(n=document.createEvent("MouseEvents"),n.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null)),a.dispatchEvent(n)},sheet2blob:function(e,t){let o={SheetNames:[t=t||"sheet1"],Sheets:{}};o.Sheets[t]=e;let n=XLSX.write(o,{bookType:"xlsx",bookSST:!1,type:"binary"});return new Blob([function(e){let t=new ArrayBuffer(e.length),o=new Uint8Array(t);for(let t=0;t!=e.length;++t)o[t]=255&e.charCodeAt(t);return t}(n)],{type:"application/octet-stream"})}};e.bigDataDown=t}(window);